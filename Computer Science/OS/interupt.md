

# 인터럽트
- CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 예외 상황에 발생하여 처리가 필요한 경우에 CPU에 알려서 처리하는 기술
- 필요한 이유? 선점형 스케줄링의 구현, IO Device와의 커뮤니케이션, 예외상황 핸들링
- 인터럽트는 일종의 이벤트로 불림
- 이벤트에 맞게 운영체제가 처리
- 인터럽트와 프로세스
    1. 프로세스 실행 중 인터럽트 발생
    2. 현 프로세스 실행중단
    3. 인터럽트 처리 함수 실행(운영체제) - 커널 모드
    4. 현 프로세스 재실행

### 인터럽트 종류
- 내부 인터럽트(소프트웨어 인터럽트)
    - 계산하는 코드에서 0으로 나누는 코드 실행시
    - 타이머 인터럽트 : 타이머 인터럽트를 발생시키는 칩이 존재. 선점형 스케줄러를 위해 필요.
    - 계산 결과가Overflow/Underflow날 때
    - 사용자 모드에서 허용되지 않은 명령 또는 공간 접근시
- 외부인터럽트
    - 입출력 인터럽트, 전원이상, 기계문제

### 인터럽트 내부동작
- 시스템콜 인터럽트
    - 시스템콜을 실행하기 위해서 강제로 코드에 인터럽트 명령을 넣어, CPU에게 실행시켜야 한다
    - 시스템 콜 실제코드
        ```C
        mov eax, 1 //시스템콜 번호
        mox ebx, 0 // 인자
        int 0x80 // 소프트웨어 인터럽트 명령
        ```
        - eax 레지스터에 시스템 콜 번호를 넣고,  ebx 레지스터에는 시스템 콜에 해당하는 인자값을 넣고, 소프트웨어 인터럽트 명령을 호출하면서 0x80을 넘겨줌
        - CPU는 사용자 모드를 커널모드로 바꿔줌
        - IDT(Interrupt Descriptor Table)에서 0x80에 해당하는 주소를 찾아서 실행함
        - system_cal() 함수에서 eax로부터 시스템 콜 번호를 찾아서, 해당 번호에 맞는 시스템콜 함수로 이동
        - 해당 시스템콜 함수 실행 후, 다시 커널모드에서 사용자 모두로 변경하고, 다시 해당 프로세스 다음 코드 진행

### IDT(Interrupt Descriptor Table)        
- 인터럽트는 미리 정의되어 각각 번호와 실행코드를 가리키는 주소가  _IDT_ 에 기록되어 있음 
- 컴퓨터 부팅시 운영체제가 기록함
- 운영체제 내부 코드임

---
__reference__
- [패스트캠퍼스 컴퓨터공학 운영체제 - 이준희]